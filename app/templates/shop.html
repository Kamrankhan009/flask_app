{% extends 'nav.html' %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/card.css')}}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/shop.css')}}">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  
<style>
    .card {
        opacity: 0.8;
        max-width: 25rem;
        height: 400px;
        margin-bottom: 10%;
        background-color: black;
        border: .5px solid red;
    }

    .card-img-top {
        object-fit: cover;
        width: 100%;
        height: 100%; /* Adjust the image height as desired */
        border-radius: inherit;
        background-color: black;
    }

    .card-body {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.8);
        color: white; /* Change to white */
        padding: 10px;
        
    }
</style>

<div class="row">
    {% for product in products %}
    <div class="col-lg-4 col-md-4">
        <div class="card" style="width: 20rem;">
            <a href="/products/{{product.id}}">
                <img src="{{ url_for('uploaded_product_images', filename=product.image) }}" class="card-img-top" alt="Card Image">
            </a>
            <div class="card-body" style="color: white;">
                <p class="card-title">{{product.title[:10]}}.</p>
                <p class="card-text">{{product.description[:10]}}. </p>
                    
                  {% set prices = [] %}
                    {% for product1 in offer %}

                    {% if product1.p_id == product.id %}
                    {% set _ = prices.append(product1.price) %}
                    {% endif %}
                    {% endfor %}

                    {% set min_price = prices | min %}

                <p class="card-text">$ <span id="product-price">{% if min_price %} {{min_price}}
                    {% else %}
                    {{product.price}}
                    
                    {% endif %}
                </span> </p>


                {%if product.quantity%}
                <p class="card-text">
                    {{product.quantity}} Products Remaining
                </p>
                {%endif%}

                {%if product.in_stock == 0%}
                <button class="btn btn-danger disabled" >Out of Stock</button>
                {%else%}
                <button class="add-to-cart btn btn-danger" data-item-id="{{product.id}}">Add to Cart</button>
        
                
                {%endif%}

            </div>
        </div>
    </div>
    {% endfor %}
</div>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script src="{{ url_for('static', filename='js/redgraph.js') }}"></script>
{% endblock%}
